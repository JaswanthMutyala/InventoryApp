{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/inventory-app/app/page.js"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport Link from 'next/link';\n\n// Helper function to format date\nconst formatDate = (dateString) => {\n  if (!dateString) return '-';\n  const date = new Date(dateString);\n  return date.toLocaleString('en-US', {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit'\n  });\n};\n\n// Status badge component\nconst StatusBadge = ({ status }) => {\n  const statusConfig = {\n    CHECKOUT: { text: 'Checked Out', color: 'bg-blue-100 text-blue-800' },\n    RETURN: { text: 'Returned', color: 'bg-green-100 text-green-800' },\n    OVERDUE: { text: 'Overdue', color: 'bg-red-100 text-red-800' },\n  };\n  \n  const config = statusConfig[status] || { text: status, color: 'bg-gray-100 text-gray-800' };\n  \n  return (\n    <span className={`text-xs font-medium px-2.5 py-0.5 rounded-full ${config.color}`}>\n      {config.text}\n    </span>\n  );\n};\n\nexport default function Dashboard() {\n  const router = useRouter();\n  const [user, setUser] = useState(null);\n  const [stats, setStats] = useState({ \n    totalProducts: 0, \n    lowStock: 0, \n    recentTransactions: [], \n    userCheckouts: [],\n    userTransactions: [] \n  });\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    const storedUser = localStorage.getItem('user');\n    if (!storedUser) {\n      router.push('/login');\n    } else {\n      const userData = JSON.parse(storedUser);\n      setUser(userData);\n      fetchStats(userData);\n    }\n  }, [router]);\n\n  const fetchStats = async (userData) => {\n    try {\n      const [productsRes, outstandingRes, transactionsRes] = await Promise.all([\n        fetch('/api/products'),\n        fetch(`/api/transactions/outstanding?user_id=${userData.id}`),\n        fetch(userData.role === 'admin' ? '/api/transactions' : `/api/transactions?user_id=${userData.id}`)\n      ]);\n\n      const productsData = await productsRes.json();\n      const outstandingData = await outstandingRes.json();\n      const transactionsData = await transactionsRes.json();\n\n      const products = Array.isArray(productsData) ? productsData : [];\n      const outstanding = Array.isArray(outstandingData) ? outstandingData : [];\n      const transactions = Array.isArray(transactionsData) ? transactionsData : [];\n\n      // Get user's transactions (both checkouts and returns)\n      const userTransactions = transactions\n        .map(tx => ({\n          ...tx,\n          product_name: products.find(p => p.id === tx.product_id)?.name || 'Unknown Product'\n        }))\n        .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))\n        .slice(0, 5); // Show only 5 most recent transactions\n\n      setStats({\n        totalProducts: products.length,\n        lowStock: products.filter(p => p.quantity < 5).length,\n        recentTransactions: userTransactions,\n        userCheckouts: outstanding.map(o => {\n          const product = products.find(p => p.id === o.product_id);\n          const checkoutTransaction = transactions.find(t => \n            t.product_id === o.product_id && \n            t.user_id === userData.id && \n            t.type === 'CHECKOUT'\n          );\n          \n          return { \n            ...o, \n            product_name: product?.name || 'Unknown Product',\n            checkout_date: checkoutTransaction ? formatDate(checkoutTransaction.timestamp) : '-',\n            status: 'CHECKOUT'\n          };\n        }),\n        userTransactions: userTransactions\n      });\n    } catch (error) {\n      console.error('Failed to fetch stats', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  if (!user || isLoading) return null;\n\n  const isAdmin = user.role === 'admin';\n\n  return (\n    <div>\n      <header style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem', paddingBottom: '1.5rem', borderBottom: '1px solid #e2e8f0' }}>\n        <div>\n          <h1 style={{ fontSize: '1.5rem', fontWeight: 600, color: '#1e293b', margin: 0, marginBottom: '0.5rem' }}>Welcome {user.name}</h1>\n          <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', fontSize: '0.95rem', color: '#64748b' }}>\n            <span>Student ID: {user.student_id}</span>\n            <span className={`badge ${isAdmin ? 'badge-primary' : 'badge-success'}`}>\n              {isAdmin ? 'Admin' : 'member'}\n            </span>\n          </div>\n        </div>\n        <button\n          onClick={() => { localStorage.removeItem('user'); router.push('/login'); }}\n          className=\"btn btn-secondary\"\n          style={{ padding: '0.35rem 0.6rem !important', fontSize: '0.7rem !important', height: 'auto', minHeight: '24px', lineHeight: '1.2', width: 'auto' }}\n        >\n          Logout\n        </button>\n      </header>\n\n      <div style={{ marginBottom: '2rem' }}>\n        <h2 style={{ fontSize: '1rem', fontWeight: 600, color: '#1e293b', marginBottom: '1rem' }}>Overview</h2>\n        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '2rem' }}>\n          <div>\n            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>\n              <span style={{ color: '#64748b', fontSize: '0.95rem' }}>Total Products</span>\n              <span style={{ fontSize: '1.75rem', fontWeight: 700, color: '#3b82f6' }}>{stats.totalProducts}</span>\n            </div>\n            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n              <span style={{ color: '#64748b', fontSize: '0.95rem' }}>Low Stock Items</span>\n              <span style={{ fontSize: '1.75rem', fontWeight: 700, color: stats.lowStock > 0 ? '#dc2626' : '#22c55e' }}>{stats.lowStock}</span>\n            </div>\n          </div>\n          <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>\n            <Link href=\"/transactions\" className=\"btn btn-primary\" style={{ textDecoration: 'none', textAlign: 'center' }}>\n              Take / Return\n            </Link>\n            {isAdmin && (\n              <Link href=\"/inventory\" className=\"btn btn-secondary\" style={{ textDecoration: 'none', textAlign: 'center' }}>\n               Manage\n              </Link>\n            )}\n          </div>\n        </div>\n      </div>\n\n      <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\">\n        <div className=\"px-4 py-3 border-b border-gray-200 bg-gray-50\">\n          <h2 className=\"text-base font-semibold text-gray-800\">Current Checkouts</h2>\n          <p className=\"text-xs text-gray-500 mt-1\">Items currently checked out under your name</p>\n        </div>\n        \n        {stats.userCheckouts.length > 0 ? (\n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full divide-y divide-gray-200\">\n              <thead className=\"bg-gray-50\">\n                <tr>\n                  <th scope=\"col\" className=\"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Product</th>\n                  <th scope=\"col\" className=\"px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider\">Qty</th>\n                  <th scope=\"col\" className=\"px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider\">Checked Out</th>\n                </tr>\n              </thead>\n              <tbody className=\"bg-white divide-y divide-gray-200\">\n                {stats.userCheckouts.map((item) => (\n                  <tr key={`${item.product_id}-${item.checkout_date}`} className=\"hover:bg-gray-50\">\n                    <td className=\"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900\">{item.product_name}</td>\n                    <td className=\"px-4 py-3 whitespace-nowrap text-center text-sm text-orange-600 font-medium\">{item.outstanding}</td>\n                    <td className=\"px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500\">{item.checkout_date}</td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n            <div className=\"px-4 py-3 bg-gray-50 flex justify-between items-center\">\n              <Link \n                href=\"/transactions\" \n                className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n              >\n                Manage Checkouts\n              </Link>\n              <Link \n                href=\"/history\" \n                className=\"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n              >\n                View Full History â†’\n              </Link>\n            </div>\n          </div>\n        ) : (\n          <div className=\"p-6 text-center\">\n            <p className=\"text-gray-500 text-sm mb-4\">No items currently checked out</p>\n            <Link \n              href=\"/history\" \n              className=\"btn btn-primary\"\n              style={{ display: 'inline-block', textDecoration: 'none', textAlign: 'center' }}\n            >\n              View Transaction History\n            </Link>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}