{"version":3,"sources":["../../../../app/history/page.js"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\n\r\n// Helper function to format date only (no time)\r\nconst formatDate = (dateString) => {\r\n  if (!dateString) return '-';\r\n  const date = new Date(dateString);\r\n  return date.toLocaleDateString('en-US', {\r\n    year: 'numeric',\r\n    month: '2-digit',\r\n    day: '2-digit'\r\n  });\r\n};\r\n\r\nexport default function TransactionHistory() {\r\n  const router = useRouter();\r\n  const [user, setUser] = useState(null);\r\n  const [transactions, setTransactions] = useState([]);\r\n  const [products, setProducts] = useState([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [filters, setFilters] = useState({\r\n    userName: '',\r\n    productName: 'All',\r\n    date: '',\r\n    type: 'All'\r\n  });\r\n\r\n  useEffect(() => {\r\n    const storedUser = localStorage.getItem('user');\r\n    if (!storedUser) {\r\n      router.push('/login');\r\n    } else {\r\n      const userData = JSON.parse(storedUser);\r\n      setUser(userData);\r\n      fetchData(userData);\r\n    }\r\n  }, [router]);\r\n\r\n  const fetchData = async (userData) => {\r\n    try {\r\n      const [transactionsRes, productsRes] = await Promise.all([\r\n        fetch('/api/transactions'),\r\n        fetch('/api/products')\r\n      ]);\r\n\r\n      const transactionsData = await transactionsRes.json();\r\n      const productsData = await productsRes.json();\r\n      \r\n      setProducts(productsData);\r\n      setTransactions(transactionsData);\r\n    } catch (error) {\r\n      console.error('Failed to fetch data', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleFilterChange = (e) => {\r\n    const { name, value } = e.target;\r\n    setFilters(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n  };\r\n\r\n  const filteredTransactions = transactions.filter(tx => {\r\n    const productName = products.find(p => p.id === tx.product_id)?.name || 'Unknown Product';\r\n    \r\n    return (\r\n      (filters.userName === '' || tx.user_name?.toLowerCase().includes(filters.userName.toLowerCase())) &&\r\n      (filters.productName === 'All' || productName === filters.productName) &&\r\n      (filters.date === '' || formatDate(tx.timestamp) === filters.date) &&\r\n      (filters.type === 'All' || tx.type === filters.type)\r\n    );\r\n  });\r\n\r\n  if (!user || isLoading) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div style={{ maxWidth: '1000px', margin: '0 auto' }}>\r\n      <h1 style={{ fontSize: '1.5rem', fontWeight: 600, marginBottom: '1.5rem', color: '#1e293b' }}>\r\n        Transaction History\r\n      </h1>\r\n\r\n      {/* Filters */}\r\n      <div className=\"card\" style={{ marginBottom: '1.5rem', display: 'flex', flexDirection: 'column', gap: '1rem' }}>\r\n        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1rem' }}>\r\n          {/* User Name Filter */}\r\n          <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>\r\n            <label style={{ fontSize: '0.875rem', fontWeight: 500, color: '#374151' }}>User Name</label>\r\n            <input\r\n              type=\"text\"\r\n              name=\"userName\"\r\n              value={filters.userName}\r\n              onChange={handleFilterChange}\r\n              className=\"input\"\r\n              placeholder=\"Search...\"\r\n              style={{ padding: '0.625rem 0.75rem', fontSize: '0.875rem' }}\r\n            />\r\n          </div>\r\n\r\n          {/* Product Filter */}\r\n          <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>\r\n            <label style={{ fontSize: '0.875rem', fontWeight: 500, color: '#374151' }}>Product</label>\r\n            <select\r\n              name=\"productName\"\r\n              value={filters.productName}\r\n              onChange={handleFilterChange}\r\n              className=\"input\"\r\n              style={{ padding: '0.625rem 0.75rem', fontSize: '0.875rem', cursor: 'pointer' }}\r\n            >\r\n              <option value=\"All\">All</option>\r\n              {products.map(product => (\r\n                <option key={product.id} value={product.name}>{product.name}</option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n\r\n          {/* Date Filter */}\r\n          <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>\r\n            <label style={{ fontSize: '0.875rem', fontWeight: 500, color: '#374151' }}>Date</label>\r\n            <input\r\n              type=\"date\"\r\n              name=\"date\"\r\n              value={filters.date}\r\n              onChange={handleFilterChange}\r\n              className=\"input\"\r\n              style={{ padding: '0.625rem 0.75rem', fontSize: '0.875rem' }}\r\n            />\r\n          </div>\r\n\r\n          {/* Type Filter */}\r\n          <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>\r\n            <label style={{ fontSize: '0.875rem', fontWeight: 500, color: '#374151' }}>Type</label>\r\n            <select\r\n              name=\"type\"\r\n              value={filters.type}\r\n              onChange={handleFilterChange}\r\n              className=\"input\"\r\n              style={{ padding: '0.625rem 0.75rem', fontSize: '0.875rem', cursor: 'pointer' }}\r\n            >\r\n              <option value=\"All\">All</option>\r\n              <option value=\"CHECKOUT\">Checkout</option>\r\n              <option value=\"CHECKIN\">Return</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Transactions Table */}\r\n      <div className=\"card\">\r\n        <h2 style={{ fontSize: '1rem', fontWeight: 600, marginBottom: '1rem', color: '#1e293b' }}>\r\n          Transaction History\r\n        </h2>\r\n        \r\n        {filteredTransactions.length > 0 ? (\r\n          <div style={{ overflowX: 'auto' }}>\r\n            <table style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n              <thead>\r\n                <tr style={{ borderBottom: '1px solid #e2e8f0', backgroundColor: '#f8fafc' }}>\r\n                  <th style={{ padding: '0.75rem', textAlign: 'left', fontSize: '0.875rem', fontWeight: 600, color: '#64748b' }}>User Name</th>\r\n                  <th style={{ padding: '0.75rem', textAlign: 'left', fontSize: '0.875rem', fontWeight: 600, color: '#64748b' }}>Product</th>\r\n                  <th style={{ padding: '0.75rem', textAlign: 'center', fontSize: '0.875rem', fontWeight: 600, color: '#64748b' }}>Quantity</th>\r\n                  <th style={{ padding: '0.75rem', textAlign: 'center', fontSize: '0.875rem', fontWeight: 600, color: '#64748b' }}>Type</th>\r\n                  <th style={{ padding: '0.75rem', textAlign: 'center', fontSize: '0.875rem', fontWeight: 600, color: '#64748b' }}>Date</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {filteredTransactions.map((tx, index) => {\r\n                  const productName = products.find(p => p.id === tx.product_id)?.name || 'Unknown Product';\r\n                  const typeLabel = tx.type === 'CHECKOUT' ? 'took' : 'return';\r\n                  \r\n                  return (\r\n                    <tr key={index} style={{ borderBottom: '1px solid #e2e8f0' }}>\r\n                      <td style={{ padding: '0.75rem', fontSize: '0.875rem', color: '#1e293b' }}>{tx.user_name || '-'}</td>\r\n                      <td style={{ padding: '0.75rem', fontSize: '0.875rem', color: '#1e293b' }}>{productName}</td>\r\n                      <td style={{ padding: '0.75rem', textAlign: 'center', fontSize: '0.875rem', color: '#1e293b' }}>{tx.quantity}</td>\r\n                      <td style={{ padding: '0.75rem', textAlign: 'center', fontSize: '0.875rem', color: '#1e293b' }}>{typeLabel}</td>\r\n                      <td style={{ padding: '0.75rem', textAlign: 'center', fontSize: '0.875rem', color: '#1e293b' }}>{formatDate(tx.timestamp)}</td>\r\n                    </tr>\r\n                  );\r\n                })}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        ) : (\r\n          <div style={{ padding: '2rem', textAlign: 'center', color: '#64748b' }}>\r\n            <p>No transactions yet</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}