{"version":3,"sources":["../../../../app/page.js"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport Link from 'next/link';\n\n// Helper function to format date\nconst formatDate = (dateString) => {\n  if (!dateString) return '-';\n  const date = new Date(dateString);\n  return date.toLocaleString('en-US', {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit'\n  });\n};\n\n// Status badge component\nconst StatusBadge = ({ status }) => {\n  const statusConfig = {\n    CHECKOUT: { text: 'Checked Out', color: 'bg-blue-100 text-blue-800' },\n    RETURN: { text: 'Returned', color: 'bg-green-100 text-green-800' },\n    OVERDUE: { text: 'Overdue', color: 'bg-red-100 text-red-800' },\n  };\n  \n  const config = statusConfig[status] || { text: status, color: 'bg-gray-100 text-gray-800' };\n  \n  return (\n    <span className={`text-xs font-medium px-2.5 py-0.5 rounded-full ${config.color}`}>\n      {config.text}\n    </span>\n  );\n};\n\nexport default function Dashboard() {\n  const router = useRouter();\n  const [user, setUser] = useState(null);\n  const [stats, setStats] = useState({ \n    totalProducts: 0, \n    lowStock: 0, \n    recentTransactions: [], \n    userCheckouts: [],\n    userTransactions: [] \n  });\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    const storedUser = localStorage.getItem('user');\n    if (!storedUser) {\n      router.push('/login');\n    } else {\n      const userData = JSON.parse(storedUser);\n      setUser(userData);\n      fetchStats(userData);\n    }\n  }, [router]);\n\n  const fetchStats = async (userData) => {\n    try {\n      const [productsRes, outstandingRes, transactionsRes] = await Promise.all([\n        fetch('/api/products'),\n        fetch(`/api/transactions/outstanding?user_id=${userData.id}`),\n        fetch(userData.role === 'admin' ? '/api/transactions' : `/api/transactions?user_id=${userData.id}`)\n      ]);\n\n      const products = await productsRes.json();\n      const outstanding = await outstandingRes.json();\n      const transactions = await transactionsRes.json();\n\n      // Get user's transactions (both checkouts and returns)\n      const userTransactions = transactions\n        .map(tx => ({\n          ...tx,\n          product_name: products.find(p => p.id === tx.product_id)?.name || 'Unknown Product'\n        }))\n        .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))\n        .slice(0, 5); // Show only 5 most recent transactions\n\n      setStats({\n        totalProducts: products.length,\n        lowStock: products.filter(p => p.quantity < 5).length,\n        recentTransactions: userTransactions,\n        userCheckouts: outstanding.map(o => {\n          const product = products.find(p => p.id === o.product_id);\n          const checkoutTransaction = transactions.find(t => \n            t.product_id === o.product_id && \n            t.user_id === userData.id && \n            t.type === 'CHECKOUT'\n          );\n          \n          return { \n            ...o, \n            product_name: product?.name || 'Unknown Product',\n            checkout_date: checkoutTransaction ? formatDate(checkoutTransaction.timestamp) : '-',\n            status: 'CHECKOUT'\n          };\n        }),\n        userTransactions: userTransactions\n      });\n    } catch (error) {\n      console.error('Failed to fetch stats', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  if (!user || isLoading) return null;\n\n  const isAdmin = user.role === 'admin';\n\n  return (\n    <div>\n      <header style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem', paddingBottom: '1.5rem', borderBottom: '1px solid #e2e8f0' }}>\n        <div>\n          <h1 style={{ fontSize: '1.5rem', fontWeight: 600, color: '#1e293b', margin: 0, marginBottom: '0.5rem' }}>Welcome {user.name}</h1>\n          <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', fontSize: '0.95rem', color: '#64748b' }}>\n            <span>Student ID: {user.student_id}</span>\n            <span className={`badge ${isAdmin ? 'badge-primary' : 'badge-success'}`}>\n              {isAdmin ? 'Admin' : 'member'}\n            </span>\n          </div>\n        </div>\n        <button\n          onClick={() => { localStorage.removeItem('user'); router.push('/login'); }}\n          className=\"btn btn-secondary\"\n          style={{ padding: '0.35rem 0.6rem !important', fontSize: '0.7rem !important', height: 'auto', minHeight: '24px', lineHeight: '1.2', width: 'auto' }}\n        >\n          Logout\n        </button>\n      </header>\n\n      <div style={{ marginBottom: '2rem' }}>\n        <h2 style={{ fontSize: '1rem', fontWeight: 600, color: '#1e293b', marginBottom: '1rem' }}>Overview</h2>\n        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '2rem' }}>\n          <div>\n            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>\n              <span style={{ color: '#64748b', fontSize: '0.95rem' }}>Total Products</span>\n              <span style={{ fontSize: '1.75rem', fontWeight: 700, color: '#3b82f6' }}>{stats.totalProducts}</span>\n            </div>\n            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n              <span style={{ color: '#64748b', fontSize: '0.95rem' }}>Low Stock Items</span>\n              <span style={{ fontSize: '1.75rem', fontWeight: 700, color: stats.lowStock > 0 ? '#dc2626' : '#22c55e' }}>{stats.lowStock}</span>\n            </div>\n          </div>\n          <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>\n            <Link href=\"/transactions\" className=\"btn btn-primary\" style={{ textDecoration: 'none', textAlign: 'center' }}>\n              Take / Return\n            </Link>\n            {isAdmin && (\n              <Link href=\"/inventory\" className=\"btn btn-secondary\" style={{ textDecoration: 'none', textAlign: 'center' }}>\n               Manage\n              </Link>\n            )}\n          </div>\n        </div>\n      </div>\n\n      <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden\">\n        <div className=\"px-4 py-3 border-b border-gray-200 bg-gray-50\">\n          <h2 className=\"text-base font-semibold text-gray-800\">Current Checkouts</h2>\n          <p className=\"text-xs text-gray-500 mt-1\">Items currently checked out under your name</p>\n        </div>\n        \n        {stats.userCheckouts.length > 0 ? (\n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full divide-y divide-gray-200\">\n              <thead className=\"bg-gray-50\">\n                <tr>\n                  <th scope=\"col\" className=\"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Product</th>\n                  <th scope=\"col\" className=\"px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider\">Qty</th>\n                  <th scope=\"col\" className=\"px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider\">Checked Out</th>\n                </tr>\n              </thead>\n              <tbody className=\"bg-white divide-y divide-gray-200\">\n                {stats.userCheckouts.map((item) => (\n                  <tr key={`${item.product_id}-${item.checkout_date}`} className=\"hover:bg-gray-50\">\n                    <td className=\"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900\">{item.product_name}</td>\n                    <td className=\"px-4 py-3 whitespace-nowrap text-center text-sm text-orange-600 font-medium\">{item.outstanding}</td>\n                    <td className=\"px-4 py-3 whitespace-nowrap text-center text-sm text-gray-500\">{item.checkout_date}</td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n            <div className=\"px-4 py-3 bg-gray-50 flex justify-between items-center\">\n              <Link \n                href=\"/transactions\" \n                className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n              >\n                Manage Checkouts\n              </Link>\n              <Link \n                href=\"/history\" \n                className=\"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n              >\n                View Full History â†’\n              </Link>\n            </div>\n          </div>\n        ) : (\n          <div className=\"p-6 text-center\">\n            <p className=\"text-gray-500 text-sm mb-4\">No items currently checked out</p>\n            <Link \n              href=\"/history\" \n              className=\"btn btn-primary\"\n              style={{ display: 'inline-block', textDecoration: 'none', textAlign: 'center' }}\n            >\n              View Transaction History\n            </Link>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}