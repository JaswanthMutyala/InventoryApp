module.exports=[6149,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944);function e(){let a=(0,d.useRouter)(),[e,f]=(0,c.useState)([]),[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)([]),[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)("CHECKOUT"),[o,p]=(0,c.useState)([]),[q,r]=(0,c.useState)(""),[s,t]=(0,c.useState)(1),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)("");(0,c.useEffect)(()=>{let b=localStorage.getItem("user");b?(l(JSON.parse(b)),A()):a.push("/login")},[a]);let A=async()=>{let[a,b]=await Promise.all([fetch("/api/transactions"),fetch("/api/products")]);f(await a.json()),h(await b.json());let c=localStorage.getItem("user");if(c){let a=JSON.parse(c),b=await fetch(`/api/transactions/outstanding?user_id=${a.id}`);j(await b.json())}},B=a=>{let b=i.find(b=>b.product_id===parseInt(a));return b?.outstanding||0},C=async a=>{if(a.preventDefault(),v(""),x(""),0===o.length)return void v("Please add at least one item");try{let a=o.map(a=>fetch("/api/transactions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:k.id,product_id:a.product_id,quantity:a.quantity,type:m})}));(await Promise.all(a)).every(a=>a.ok)?(x(`Successfully ${"CHECKOUT"===m?"took":"returned"} ${o.length} product(s)!`),p([]),A(),setTimeout(()=>x(""),1500)):v("Some transactions failed. Please try again.")}catch(a){v(a.message||"Transaction failed")}};return(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"section-title",children:"Transactions"}),(0,b.jsxs)("div",{className:"card mb-6",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"New Transaction"}),u&&(0,b.jsx)("div",{style:{backgroundColor:"#fee2e2",border:"2px solid #ef4444",borderRadius:"var(--radius)",padding:"1rem",marginBottom:"1.5rem",display:"flex",alignItems:"flex-start",gap:"0.75rem"},children:(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{style:{color:"#991b1b",fontWeight:600,marginBottom:"0.25rem"},children:"Transaction Failed"}),(0,b.jsx)("p",{style:{color:"#dc2626",fontSize:"0.875rem",lineHeight:1.5},children:u})]})}),w&&(0,b.jsxs)("div",{style:{backgroundColor:"#dcfce7",border:"2px solid #22c55e",borderRadius:"var(--radius)",padding:"1rem",marginBottom:"1.5rem",display:"flex",alignItems:"flex-start",gap:"0.75rem"},children:[(0,b.jsx)("span",{style:{fontSize:"1.25rem",lineHeight:1},children:"âœ…"}),(0,b.jsx)("p",{style:{color:"#15803d",fontWeight:600,fontSize:"0.95rem"},children:w})]}),(0,b.jsxs)("div",{style:{marginBottom:"1.5rem"},children:[(0,b.jsx)("h3",{style:{fontSize:"0.95rem",fontWeight:600,marginBottom:"1rem",color:"#1e293b"},children:"Transaction Type"}),(0,b.jsxs)("div",{style:{display:"flex",gap:"1rem",marginBottom:"1.5rem"},children:[(0,b.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[(0,b.jsx)("input",{type:"radio",value:"CHECKOUT",checked:"CHECKOUT"===m,onChange:a=>n(a.target.value),style:{cursor:"pointer"}}),(0,b.jsx)("span",{children:"Take Products"})]}),(0,b.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[(0,b.jsx)("input",{type:"radio",value:"CHECKIN",checked:"CHECKIN"===m,onChange:a=>n(a.target.value),style:{cursor:"pointer"}}),(0,b.jsx)("span",{children:"Return Products"})]})]})]}),(0,b.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 100px",gap:"0.75rem",marginBottom:"1rem",alignItems:"flex-end"},children:[(0,b.jsxs)("div",{className:"form-group",style:{marginBottom:0},children:[(0,b.jsx)("label",{htmlFor:"product",style:{display:"block",marginBottom:"0.35rem",fontSize:"0.875rem",fontWeight:500},children:"Product"}),(0,b.jsxs)("select",{id:"product",className:"input",value:q,onChange:a=>r(a.target.value),style:{fontSize:"0.875rem",padding:"0.5rem 0.75rem",width:"100%"},children:[(0,b.jsx)("option",{value:"",children:"Select..."}),"CHECKOUT"===m?g.map(a=>(0,b.jsxs)("option",{value:String(a.id),children:[a.name," (Available: ",a.quantity,")"]},a.id)):i&&i.length>0?i.map(a=>{let c=g.find(b=>b.id===a.product_id);return c?(0,b.jsxs)("option",{value:String(a.product_id),children:[c.name," (Outstanding: ",a.outstanding,")"]},a.product_id):null}):(0,b.jsx)("option",{disabled:!0,children:"No items to return"})]})]}),(0,b.jsxs)("div",{className:"form-group",style:{marginBottom:0},children:[(0,b.jsxs)("label",{htmlFor:"quantity",style:{display:"block",marginBottom:"0.35rem",fontSize:"0.875rem",fontWeight:500},children:["Quantity","CHECKIN"===m&&q&&(0,b.jsxs)("span",{style:{fontSize:"0.75rem",color:"#64748b",marginLeft:"0.5rem"},children:["(Max: ",B(q),")"]})]}),(0,b.jsx)("input",{id:"quantity",type:"number",className:"input",min:"1",max:"CHECKIN"===m&&q?B(q):void 0,value:s,onChange:a=>t(Math.max(1,parseInt(a.target.value)||1)),style:{fontSize:"0.875rem",padding:"0.5rem 0.75rem",width:"100%"}})]}),(0,b.jsx)("button",{type:"button",onClick:()=>{if(!q)return void v("Please select a product");let a=parseInt(q),b=g.find(b=>b.id===a);if(!b)return void v("Selected product is invalid");let c=o.findIndex(b=>b.product_id===a),d=(c>=0?o[c].quantity:0)+s;if("CHECKOUT"===m){if(d>b.quantity)return void v(`Cannot take ${d} units. Only ${b.quantity} unit(s) available for ${b.name}.`)}else if("CHECKIN"===m){let c=B(a);if(d>c)return void v(`Cannot return ${d} units. You only have ${c} unit(s) outstanding for ${b.name}.`)}if(c>=0){let a=[...o];a[c].quantity=d,p(a)}else p([...o,{product_id:a,product_name:b.name,product_image:b.image_url,quantity:s}]);r(""),t(1),v("")},className:"btn btn-primary",style:{padding:"0.5rem 1rem",fontSize:"0.875rem"},children:"Add Item"})]}),"CHECKIN"===m&&i&&i.length>0&&(0,b.jsxs)("div",{style:{marginBottom:"1.5rem",backgroundColor:"#eff6ff",border:"1px solid #93c5fd",borderRadius:"var(--radius)",padding:"1rem"},children:[(0,b.jsx)("h3",{style:{fontSize:"0.95rem",fontWeight:600,marginBottom:"0.75rem",color:"#1e40af"},children:"ðŸ“‹ Products You Previously Took"}),(0,b.jsx)("div",{className:"grid gap-2",children:i.map(a=>{let c=g.find(b=>b.id===a.product_id);if(!c)return null;let d=o.find(b=>b.product_id===a.product_id);return(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem",backgroundColor:"#ffffff",border:"1px solid #bfdbfe",borderRadius:"0.375rem"},children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{style:{fontWeight:600,color:"#1e293b"},children:c.name}),(0,b.jsxs)("span",{style:{color:"#64748b",marginLeft:"0.75rem",fontSize:"0.875rem"},children:["Outstanding: ",(0,b.jsx)("span",{style:{fontWeight:600,color:"#2563eb"},children:a.outstanding})]})]}),d?(0,b.jsx)("span",{style:{fontSize:"0.75rem",color:"#059669",fontWeight:600},children:"âœ… Added"}):(0,b.jsx)("button",{type:"button",onClick:()=>{let b=a.product_id,c=g.find(a=>a.id===b),d=o.findIndex(a=>a.product_id===b),e=(d>=0?o[d].quantity:0)+1,f=a.outstanding;if(e>f)return void v(`Cannot return ${e} units. You only have ${f} unit(s) outstanding for ${c.name}.`);if(d>=0){let a=[...o];a[d].quantity=e,p(a)}else p([...o,{product_id:b,product_name:c.name,product_image:c.image_url,quantity:1}]);v("")},className:"btn",style:{backgroundColor:"#dbeafe",color:"#1e40af",border:"none",fontSize:"0.75rem",padding:"0.35rem 0.75rem"},children:"Quick Add"})]},a.product_id)})})]}),o.length>0&&(0,b.jsxs)("div",{style:{marginBottom:"1.5rem",backgroundColor:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"var(--radius)",padding:"1rem"},children:[(0,b.jsxs)("h3",{style:{fontSize:"0.95rem",fontWeight:600,marginBottom:"1rem",color:"#1e293b"},children:["Items to ","CHECKOUT"===m?"Take":"Return"," (",o.length,")"]}),(0,b.jsx)("div",{className:"grid gap-2",children:o.map(a=>(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem",backgroundColor:"#ffffff",border:"1px solid #e2e8f0",borderRadius:"0.375rem"},children:[(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[a.product_image&&(0,b.jsx)("img",{src:a.product_image,alt:a.product_name,style:{width:"40px",height:"40px",objectFit:"cover",borderRadius:"0.5rem",cursor:"pointer",flexShrink:0},onClick:()=>z(a.product_image)}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("span",{style:{fontWeight:600,color:"#1e293b"},children:[a.quantity,"x"]}),(0,b.jsx)("span",{style:{color:"#475569",marginLeft:"0.5rem"},children:a.product_name})]})]}),(0,b.jsx)("button",{type:"button",onClick:()=>{var b;return b=a.product_id,void p(o.filter(a=>a.product_id!==b))},className:"btn",style:{backgroundColor:"#fee2e2",color:"#991b1b",border:"none",fontSize:"0.75rem",padding:"0.35rem 0.75rem",width:"auto",minWidth:"auto"},children:"Remove"})]},a.product_id))})]}),y&&(0,b.jsx)("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1100},onClick:()=>z(""),children:(0,b.jsx)("div",{style:{backgroundColor:"#fff",padding:"1rem",borderRadius:"0.75rem",maxWidth:"90vw",maxHeight:"90vh",boxShadow:"var(--shadow-lg)"},onClick:a=>a.stopPropagation(),children:(0,b.jsx)("img",{src:y,alt:"Product image",style:{maxWidth:"80vw",maxHeight:"80vh",objectFit:"contain",display:"block"}})})}),(0,b.jsxs)("button",{type:"submit",className:"btn btn-primary",onClick:C,disabled:0===o.length,style:{width:"100%",opacity:0===o.length?.5:1,cursor:0===o.length?"not-allowed":"pointer"},children:["Complete ","CHECKOUT"===m?"Checkout":"Return"," (",o.length," items)"]})]})]})}a.s(["default",()=>e])}];

//# sourceMappingURL=app_transactions_page_6debc816.js.map