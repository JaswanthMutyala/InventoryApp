(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,46312,e=>{"use strict";var t=e.i(43476),i=e.i(71645),r=e.i(18566);function n(){let e=(0,r.useRouter)(),[n,a]=(0,i.useState)([]),[o,s]=(0,i.useState)([]),[d,l]=(0,i.useState)([]),[c,u]=(0,i.useState)(null),[m,p]=(0,i.useState)("CHECKOUT"),[g,f]=(0,i.useState)([]),[h,y]=(0,i.useState)(""),[x,b]=(0,i.useState)(1),[j,v]=(0,i.useState)(""),[C,S]=(0,i.useState)(""),[k,_]=(0,i.useState)("");(0,i.useEffect)(()=>{let t=localStorage.getItem("user");t?(u(JSON.parse(t)),I()):e.push("/login")},[e]);let I=async()=>{let[e,t]=await Promise.all([fetch("/api/transactions"),fetch("/api/products")]);a(await e.json()),s(await t.json());let i=localStorage.getItem("user");if(i){let e=JSON.parse(i),t=await fetch(`/api/transactions/outstanding?user_id=${e.id}`);l(await t.json())}},T=e=>{let t=d.find(t=>t.product_id===parseInt(e));return t?.outstanding||0},N=async e=>{if(e.preventDefault(),v(""),S(""),0===g.length)return void v("Please add at least one item");try{let e=g.map(e=>fetch("/api/transactions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:c.id,product_id:e.product_id,quantity:e.quantity,type:m})}));(await Promise.all(e)).every(e=>e.ok)?(S(`Successfully ${"CHECKOUT"===m?"took":"returned"} ${g.length} product(s)!`),f([]),I(),setTimeout(()=>S(""),1500)):v("Some transactions failed. Please try again.")}catch(e){v(e.message||"Transaction failed")}};return(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"section-title",children:"Transactions"}),(0,t.jsxs)("div",{className:"card mb-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"New Transaction"}),j&&(0,t.jsx)("div",{style:{backgroundColor:"#fee2e2",border:"2px solid #ef4444",borderRadius:"var(--radius)",padding:"1rem",marginBottom:"1.5rem",display:"flex",alignItems:"flex-start",gap:"0.75rem"},children:(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{style:{color:"#991b1b",fontWeight:600,marginBottom:"0.25rem"},children:"Transaction Failed"}),(0,t.jsx)("p",{style:{color:"#dc2626",fontSize:"0.875rem",lineHeight:1.5},children:j})]})}),C&&(0,t.jsxs)("div",{style:{backgroundColor:"#dcfce7",border:"2px solid #22c55e",borderRadius:"var(--radius)",padding:"1rem",marginBottom:"1.5rem",display:"flex",alignItems:"flex-start",gap:"0.75rem"},children:[(0,t.jsx)("span",{style:{fontSize:"1.25rem",lineHeight:1},children:"âœ…"}),(0,t.jsx)("p",{style:{color:"#15803d",fontWeight:600,fontSize:"0.95rem"},children:C})]}),(0,t.jsxs)("div",{style:{marginBottom:"1.5rem"},children:[(0,t.jsx)("h3",{style:{fontSize:"0.95rem",fontWeight:600,marginBottom:"1rem",color:"#1e293b"},children:"Transaction Type"}),(0,t.jsxs)("div",{style:{display:"flex",gap:"1rem",marginBottom:"1.5rem"},children:[(0,t.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[(0,t.jsx)("input",{type:"radio",value:"CHECKOUT",checked:"CHECKOUT"===m,onChange:e=>p(e.target.value),style:{cursor:"pointer"}}),(0,t.jsx)("span",{children:"Take Products"})]}),(0,t.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[(0,t.jsx)("input",{type:"radio",value:"CHECKIN",checked:"CHECKIN"===m,onChange:e=>p(e.target.value),style:{cursor:"pointer"}}),(0,t.jsx)("span",{children:"Return Products"})]})]})]}),(0,t.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 100px",gap:"0.75rem",marginBottom:"1rem",alignItems:"flex-end"},children:[(0,t.jsxs)("div",{className:"form-group",style:{marginBottom:0},children:[(0,t.jsx)("label",{htmlFor:"product",style:{display:"block",marginBottom:"0.35rem",fontSize:"0.875rem",fontWeight:500},children:"Product"}),(0,t.jsxs)("select",{id:"product",className:"input",value:h,onChange:e=>y(e.target.value),style:{fontSize:"0.875rem",padding:"0.5rem 0.75rem",width:"100%"},children:[(0,t.jsx)("option",{value:"",children:"Select..."}),"CHECKOUT"===m?o.map(e=>(0,t.jsxs)("option",{value:String(e.id),children:[e.name," (Available: ",e.quantity,")"]},e.id)):d&&d.length>0?d.map(e=>{let i=o.find(t=>t.id===e.product_id);return i?(0,t.jsxs)("option",{value:String(e.product_id),children:[i.name," (Outstanding: ",e.outstanding,")"]},e.product_id):null}):(0,t.jsx)("option",{disabled:!0,children:"No items to return"})]})]}),(0,t.jsxs)("div",{className:"form-group",style:{marginBottom:0},children:[(0,t.jsxs)("label",{htmlFor:"quantity",style:{display:"block",marginBottom:"0.35rem",fontSize:"0.875rem",fontWeight:500},children:["Quantity","CHECKIN"===m&&h&&(0,t.jsxs)("span",{style:{fontSize:"0.75rem",color:"#64748b",marginLeft:"0.5rem"},children:["(Max: ",T(h),")"]})]}),(0,t.jsx)("input",{id:"quantity",type:"number",className:"input",min:"1",max:"CHECKIN"===m&&h?T(h):void 0,value:x,onChange:e=>b(Math.max(1,parseInt(e.target.value)||1)),style:{fontSize:"0.875rem",padding:"0.5rem 0.75rem",width:"100%"}})]}),(0,t.jsx)("button",{type:"button",onClick:()=>{if(!h)return void v("Please select a product");let e=parseInt(h),t=o.find(t=>t.id===e);if(!t)return void v("Selected product is invalid");let i=g.findIndex(t=>t.product_id===e),r=(i>=0?g[i].quantity:0)+x;if("CHECKOUT"===m){if(r>t.quantity)return void v(`Cannot take ${r} units. Only ${t.quantity} unit(s) available for ${t.name}.`)}else if("CHECKIN"===m){let i=T(e);if(r>i)return void v(`Cannot return ${r} units. You only have ${i} unit(s) outstanding for ${t.name}.`)}if(i>=0){let e=[...g];e[i].quantity=r,f(e)}else f([...g,{product_id:e,product_name:t.name,product_image:t.image_url,quantity:x}]);y(""),b(1),v("")},className:"btn btn-primary",style:{padding:"0.5rem 1rem",fontSize:"0.875rem"},children:"Add Item"})]}),"CHECKIN"===m&&d&&d.length>0&&(0,t.jsxs)("div",{style:{marginBottom:"1.5rem",backgroundColor:"#eff6ff",border:"1px solid #93c5fd",borderRadius:"var(--radius)",padding:"1rem"},children:[(0,t.jsx)("h3",{style:{fontSize:"0.95rem",fontWeight:600,marginBottom:"0.75rem",color:"#1e40af"},children:"ðŸ“‹ Products You Previously Took"}),(0,t.jsx)("div",{className:"grid gap-2",children:d.map(e=>{let i=o.find(t=>t.id===e.product_id);if(!i)return null;let r=g.find(t=>t.product_id===e.product_id);return(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem",backgroundColor:"#ffffff",border:"1px solid #bfdbfe",borderRadius:"0.375rem"},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{style:{fontWeight:600,color:"#1e293b"},children:i.name}),(0,t.jsxs)("span",{style:{color:"#64748b",marginLeft:"0.75rem",fontSize:"0.875rem"},children:["Outstanding: ",(0,t.jsx)("span",{style:{fontWeight:600,color:"#2563eb"},children:e.outstanding})]})]}),r?(0,t.jsx)("span",{style:{fontSize:"0.75rem",color:"#059669",fontWeight:600},children:"âœ… Added"}):(0,t.jsx)("button",{type:"button",onClick:()=>{let t=e.product_id,i=o.find(e=>e.id===t),r=g.findIndex(e=>e.product_id===t),n=(r>=0?g[r].quantity:0)+1,a=e.outstanding;if(n>a)return void v(`Cannot return ${n} units. You only have ${a} unit(s) outstanding for ${i.name}.`);if(r>=0){let e=[...g];e[r].quantity=n,f(e)}else f([...g,{product_id:t,product_name:i.name,product_image:i.image_url,quantity:1}]);v("")},className:"btn",style:{backgroundColor:"#dbeafe",color:"#1e40af",border:"none",fontSize:"0.75rem",padding:"0.35rem 0.75rem"},children:"Quick Add"})]},e.product_id)})})]}),g.length>0&&(0,t.jsxs)("div",{style:{marginBottom:"1.5rem",backgroundColor:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"var(--radius)",padding:"1rem"},children:[(0,t.jsxs)("h3",{style:{fontSize:"0.95rem",fontWeight:600,marginBottom:"1rem",color:"#1e293b"},children:["Items to ","CHECKOUT"===m?"Take":"Return"," (",g.length,")"]}),(0,t.jsx)("div",{className:"grid gap-2",children:g.map(e=>(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem",backgroundColor:"#ffffff",border:"1px solid #e2e8f0",borderRadius:"0.375rem"},children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.product_image&&(0,t.jsx)("img",{src:e.product_image,alt:e.product_name,style:{width:"40px",height:"40px",objectFit:"cover",borderRadius:"0.5rem",cursor:"pointer",flexShrink:0},onClick:()=>_(e.product_image)}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("span",{style:{fontWeight:600,color:"#1e293b"},children:[e.quantity,"x"]}),(0,t.jsx)("span",{style:{color:"#475569",marginLeft:"0.5rem"},children:e.product_name})]})]}),(0,t.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.product_id,void f(g.filter(e=>e.product_id!==t))},className:"btn",style:{backgroundColor:"#fee2e2",color:"#991b1b",border:"none",fontSize:"0.75rem",padding:"0.35rem 0.75rem",width:"auto",minWidth:"auto"},children:"Remove"})]},e.product_id))})]}),k&&(0,t.jsx)("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1100},onClick:()=>_(""),children:(0,t.jsx)("div",{style:{backgroundColor:"#fff",padding:"1rem",borderRadius:"0.75rem",maxWidth:"90vw",maxHeight:"90vh",boxShadow:"var(--shadow-lg)"},onClick:e=>e.stopPropagation(),children:(0,t.jsx)("img",{src:k,alt:"Product image",style:{maxWidth:"80vw",maxHeight:"80vh",objectFit:"contain",display:"block"}})})}),(0,t.jsxs)("button",{type:"submit",className:"btn btn-primary",onClick:N,disabled:0===g.length,style:{width:"100%",opacity:0===g.length?.5:1,cursor:0===g.length?"not-allowed":"pointer"},children:["Complete ","CHECKOUT"===m?"Checkout":"Return"," (",g.length," items)"]})]})]})}e.s(["default",()=>n])}]);